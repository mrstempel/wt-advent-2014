function map_recenter(n,t,i){var r=map.getProjection().fromLatLngToPoint(n instanceof google.maps.LatLng?n:map.getCenter()),u=new google.maps.Point((typeof t=="number"?t:0)/Math.pow(2,map.getZoom())||0,(typeof i=="number"?i:0)/Math.pow(2,map.getZoom())||0);map.setCenter(map.getProjection().fromPointToLatLng(new google.maps.Point(r.x-u.x,r.y+u.y)));console.log("map recentered")}function setZoom(n){debug("setZoom: "+n);map.setZoom(n);currentZoom=n}function zoomIn(){setZoom(currentZoom+1)}function zoomOut(){setZoom(currentZoom-1)}function initMap(){if(overlayPrefix="map",$("#zoom-control").css("display","inline-block"),$("#home-btn").css("display","inline-block"),map==null){showLoadingMsg();geocoder=new google.maps.Geocoder;var n=new google.maps.LatLng(48.175348,16.34725),t=new google.maps.StyledMapType(mapStylesArray,{name:"Snowie Map"}),i={backgroundColor:"transparent",minZoom:3,zoom:currentZoom,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,overviewMapControl:!1,streetViewControl:!1,scaleControl:!1,panControl:!1,rotateControl:!1,zoomControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};map=new google.maps.Map(document.getElementById("map-container"),i);map.mapTypes.set("map_style",t);map.setMapTypeId("map_style");google.maps.event.addListener(map,"dragend",function(){questionMarker!=null&&questionMarker.getMap()!=null&&questionFeedbackBubble.getMap()==null&&(targetMarker==null||targetMarker.getMap()==null)&&debug("recenter question marker")});google.maps.event.addListener(map,"zoom_changed",function(){currentZoom=map.getZoom();questionMarker!=null&&questionMarker.getMap()!=null&&(questionNewLat=questionMarker.getPosition().lat()-3e-5*Math.pow(2,21-map.getZoom()),questionFeedbackBubble.setPosition(new google.maps.LatLng(questionNewLat,questionMarker.getPosition().lng())))});google.maps.event.addListenerOnce(map,"projection_changed",function(){loadQuestion(null,!0);$("#map-container").css("opacity",1);$("#start-overlay-container").slideUp("fast","easeInOutQuart");debug("google-maps: projection_changed")})}else $("#map-container").css("opacity",1),$("#start-overlay-container").slideUp("fast","easeInOutQuart")}function isQuestionAnswered(n){return n.Answers!=null&&n.Answers.length>0&&n.Answers[n.Answers.length-1].IsCorrect||n.Answers.length>0&&n.Answers[n.Answers.length-1].TryCount>=maxTryCount}function resetQuestionElements(){questionMarker!=null&&questionMarker.setMap(null);currentFlightPath!=null&&currentFlightPath.setMap(null);currentFlightPathShadow!=null&&currentFlightPathShadow.setMap(null);answerFeedbackBubble.setMap(null);$(".question-how-to").hide()}function loadSpecificQuestion(n){showLoadingMsg();hideModal("sidebar",0);loadQuestion(n,!1)}function loadQuestion(n,t){debug("loadQuestion("+n+", "+t+") called");$.ajax({url:lng+"/Game/GetQuestion",type:"get",async:!0,data:{day:n,loadPrev:t},success:function(n){if(n)if($("#question").hide(),$("#reminder").hide(),debug(n),resetQuestionElements(),t?(currentQuestion=n[n.length-1],writeAnsweredMarkers(n)):currentQuestion=n,targetMarker!=null&&targetMarker.setMap(null),targetPosition=new google.maps.LatLng(currentQuestion.Question.TargetLocation.Lat,currentQuestion.Question.TargetLocation.Lng),targetMarker=new google.maps.Marker({position:targetPosition,title:currentQuestion.TranslatedTargetName,icon:new google.maps.MarkerImage("/images/eumel/"+currentQuestion.Question.Day+".png",null,null,null,new google.maps.Size(55,55)),shadow:markerShadow}),isQuestionAnswered(currentQuestion))targetMarker.setMap(map),setZoom(currentQuestion.Question.ZoomLevel),map.setCenter(targetMarker.position),google.maps.event.addListener(targetMarker,"click",function(){showMoreInfo(currentQuestion.Question.Day,0,!1)}),showAnsweredMarkers(),showReminder();else{hideAnsweredMarkers();var i=new google.maps.LatLng(currentQuestion.Question.StartLocation.Lat,currentQuestion.Question.StartLocation.Lng),r="/images/eumel/dragger-rot-"+mySnowieVersion+".png";questionMarker=new google.maps.Marker({position:i,title:currentQuestion.TranslatedTitle,icon:new google.maps.MarkerImage(r,null,null,null,new google.maps.Size(55,55)),map:map,shadow:markerShadow,draggable:!0});google.maps.event.addListener(questionMarker,"dragend",function(){dropConfirm()});setZoom(currentQuestion.Question.ZoomLevel);map_recenter(questionMarker.position,0,-120);$("#question > .container > h1").html(currentQuestion.TranslatedTitle);$("#question").fadeIn();$("#question-how-to1").fadeIn();$(".btn-tipp").attr("href",currentQuestion.Link)}else alert("No Questions found");hideLoadingMsg()},error:function(){debug("/Game/GetQuestion has thrown an exception!");hideLoadingMsg()}})}function writeAnsweredMarkers(n){answerMarkers=[];$.each(n,function(n,t){t.Question.Id!=currentQuestion.Question.Id&&isQuestionAnswered(t)&&addAnsweredMarker(t)})}function addAnsweredMarker(n){var t=new google.maps.Marker({position:new google.maps.LatLng(n.Question.TargetLocation.Lat,n.Question.TargetLocation.Lng),title:n.TranslatedTargetName,icon:new google.maps.MarkerImage("/images/eumel/"+n.Question.Day+".png",null,null,null,new google.maps.Size(55,55))});google.maps.event.addListener(t,"click",function(){setMediaPixel("568030");_gaq.push(["_trackEvent","mehr-lesen-tag-"+n.Question.Day,"clicked"]);showMoreInfo(n.Question.Day,0,!1)});answerMarkers.push(t)}function showAnsweredMarkers(){debug("showAnsweredMarkers()");resetQuestionElements();showTooSmallElements();$.each(answerMarkers,function(n,t){t.setMap(map)})}function hideAnsweredMarkers(){debug("hideAnsweredMarkers()");hideTooSmallElements();$.each(answerMarkers,function(n,t){t.setMap(null)})}function dropConfirm(){var n=new google.maps.LatLngBounds;n.extend(questionMarker.position);map_recenter(questionMarker.position,0,-120);questionFeedbackBubble.setContent($("#drop-confirm").html());questionNewLat=questionMarker.getPosition().lat()-3e-5*Math.pow(2,21-map.getZoom());questionFeedbackBubble.open(map);questionFeedbackBubble.setPosition(new google.maps.LatLng(questionNewLat,questionMarker.getPosition().lng()))}function setAnswer(){var n,t;showLoadingMsg();debug("setAnswer() called");currentFlightPath!=null&&currentFlightPath.setMap(null);currentFlightPathShadow!=null&&currentFlightPathShadow.setMap(null);n=[];n.push(questionMarker.position);n.push(targetMarker.position);currentFlightPathShadow=new google.maps.Polyline({path:n,strokeColor:"#EFEFEF",strokeOpacity:1.9,strokeWeight:8});currentFlightPath=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#7d7d7d",strokeOpacity:1,strokeWeight:1});t=currentFlightPath.inKm();$.ajax({url:lng+"/Game/SetAnswer",type:"get",async:!0,data:{questionId:currentQuestion.Question.Id,locationLat:targetMarker.position.lat(),locationLng:targetMarker.position.lng(),distance:t,day:currentQuestion.Question.Day},success:function(n){debug("max: "+maxTryCount+", trycount: "+n.Answer.TryCount);n&&n.Answer.IsCorrect?showCorrectAnswer(n.Answer.TryCount,n.BonusPoints):n.Answer.TryCount>=maxTryCount?showCorrectAnswerAfterMaxTrys(t):showWrongAnswer(t,n.Answer.TryCount);hideLoadingMsg()},error:function(){debug("/Game/GetQuestion has thrown an exception!");hideLoadingMsg()}})}function showCorrectAnswer(n,t){if(debug("showCorrectAnswer called"),questionFeedbackBubble.setMap(null),showQuestionFeedback(n,5),showBonus("answer-points",t,!0),targetMarker.setMap(map),isSasmung)map_recenter(targetMarker.position,250,0);else{var i=new google.maps.LatLngBounds;i.extend(targetMarker.position);i.extend(questionMarker.position);map.fitBounds(i)}currentFlightPath.setMap(map);showAnswerMoreInfo(3);window.setTimeout(function(){hideBonus("answer-points",!1)},1300)}function showAnswerMoreInfo(n){debug("showAnswerMoreInfo called");var t=$("#answer-confirm").html().replace("{more-info-link}","_gaq.push(['_trackEvent', 'mehr-lesen-tag-"+currentQuestion.Question.Day+"', 'clicked']);showMoreInfo("+currentQuestion.Question.Day+", "+n+", true);");t=t.replace("{more-info-bonus-message}",moreInfoBonusMsg);answerFeedbackBubble.setContent(t);answerNewLat=targetMarker.getPosition().lat()-55e-6*Math.pow(2,21-map.getZoom());answerFeedbackBubble.open(map);answerFeedbackBubble.setPosition(new google.maps.LatLng(answerNewLat,targetMarker.getPosition().lng()));google.maps.event.addListener(map,"zoom_changed",function(){answerNewLat=targetMarker.getPosition().lat()-55e-6*Math.pow(2,21-map.getZoom());answerFeedbackBubble.setPosition(new google.maps.LatLng(answerNewLat,targetMarker.getPosition().lng()))});addAnsweredMarker(currentQuestion)}function showCorrectAnswerAfterMaxTrys(n){if(debug("showCorrectAnswerAfterMaxTrys called"),$("#question-how-to4 > span").html($("#question-how-to4 > span").html().replace("{km}",n+" km")),questionFeedbackBubble.setMap(null),showQuestionFeedback(3,4),questionMarker.setDraggable(!1),targetMarker.setMap(map),isSasmung)map_recenter(targetMarker.position,250,0);else{var t=new google.maps.LatLngBounds;t.extend(targetMarker.position);t.extend(questionMarker.position);map.fitBounds(t)}currentFlightPath.setMap(map);showAnswerMoreInfo(3)}function showWrongAnswer(n,t){debug("showWrongAnswer called");questionFeedbackBubble.setMap(null);showQuestionFeedback(t,++t)}function showQuestionFeedback(n,t){debug("showQuestionFeedback: "+n+", "+t);n>1&&$("#question-how-to1").hide();var r=$("#question-how-to"+n),i=$("#question-how-to"+t);$(r).hide(0,function(){$(i).show(0,function(){$(i).animate({fontSize:22},200,"linear",function(){$(i).animate({fontSize:16},150,"linear")})})})}var map,geocoder,currentZoom=14,targetPosition=null,targetMarker=null,questionMarker=null,questionFeedbackBubble=new InfoBubble({shadowStyle:0,backgroundColor:"transparent",padding:0,borderRadius:0,borderWidth:0,arrowStyle:3,hideCloseButton:!0,disableAutoPan:!0}),answerFeedbackBubble=new InfoBubble({shadowStyle:0,backgroundColor:"transparent",padding:0,borderRadius:0,borderWidth:0,arrowStyle:3,hideCloseButton:!0,disableAutoPan:!0}),currentFlightPath=null,currentFlightPathShadow=null,currentQuestion=null,questionNewLat=null,answerNewLat=null,answerMarkers=[],markerShadow=new google.maps.MarkerImage("https://www.google.com/intl/en_ALL/mapfiles/shadow50.png",new google.maps.Size(37,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),lineSymbol={path:"M 0,-1 0,1",strokeOpacity:1,strokeWeight:1.5,scale:4},mapStylesArray=[{featureType:"all",elementType:"geometry",stylers:[{visibility:"simplified"},{saturation:-70},{gamma:4.9}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"},{lightness:100}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"geometry",elementType:"labels.text",stylers:[{color:"#adadad"},{weight:.1}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"on"}]},{featureType:"transit",stylers:[{visibility:"off"}]}];google.maps.LatLng.prototype.kmTo=function(n){var t=Math,i=t.PI/180,r=this.lat()*i,u=n.lat()*i,f=r-u,e=this.lng()*i-n.lng()*i,o=2*t.asin(t.sqrt(t.pow(t.sin(f/2),2)+t.cos(r)*t.cos(u)*t.pow(t.sin(e/2),2)));return o*6378.137};google.maps.Polyline.prototype.inKm=function(n){for(var i=this.getPath(n),u=i.getLength(),r=0,t=0;t<u-1;t++)r+=i.getAt(t).kmTo(i.getAt(t+1));return parseFloat(r.toFixed(3))};
/*
//# sourceMappingURL=advent-map.min.js.map
*/